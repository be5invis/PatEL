#!/usr/bin/env node
var patel = require('../index');
var fs = require('fs');
var util = require('util');
var yargs = require('yargs')
	.alias('o', 'output-into')
	.alias('?', 'help')
	.describe('help', 'Displays this help.')
	.describe('o', 'Output sfd path. When absent, the result sfd is written to STDOUT.');

var argv = yargs.argv;
var instream = argv._[0] ? fs.createReadStream(argv._[0]): process.stdin;
var outstream = argv.o ? fs.createWriteStream(argv.o, { encoding: 'utf-8' }): process.stdout;

var input = '';
instream.on('data', function(buf){ input += buf.toString() })
instream.on('end', function(){
	var gs = patel.globals();
	var ast = patel.parse(input);
	outstream.write(patel.compile(ast, gs));
});